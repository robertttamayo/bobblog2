/*RedCodeBlueCode*/function catPopCallbacks(){$(".create-tag").on("click",function(){console.log("event listener fired"),saveCat()}),$(".tag-name").on("click",function(){$(this).hasClass("active-tag")?removeCatFromPost($(this),$("#postid-hidden").text()):addCatToPost($(this),$("#postid-hidden").text())}),$(".dim, #close-tag-pop").on("click",function(){$(".tag-pop-wrap").fadeOut("medium",function(){$(this).remove()})})}function tagPopCallbacks(){$(".create-tag").on("click",function(){saveTag()}),$(".tag-name").on("click",function(){$(this).hasClass("active-tag")?removeTagFromPost($(this),$("#postid-hidden").text()):addTagToPost($(this),$("#postid-hidden").text())}),$(".dim, #close-tag-pop").on("click",function(){$(".tags-pop-wrap").fadeOut("medium",function(){$(this).remove()})})}function mainContainerCallbacks(){$(".dim, #message-close").on("click",function(){$(".dim:not([data*=tags])").hide(),$("#message").fadeOut()}),$(".post-edit").on("click",function(){var a=$(this).data("postid");load("start"),$("#main-container").html("").load(homeUrl+"src/editor.php?postid="+a,function(){editContainerCallbacks(),load("stop")})})}function editContainerCallbacks(){$(".save-post").on("click",function(){console.log("Attempting to save post"),validatePost()&&savePost()}),$(".manage-tags").on("click",function(){var a=$("#postid-hidden").text(),b=document.createElement("div"),c=homeUrl+"src/tags.php?postid="+a;console.log(c),b=$(b),$(b).load(c,function(){$("body").append($(b)),$(".dim").show().data("lock","tags"),tagPopCallbacks()})}),$(".manage-cats").on("click",function(){var a=$("#postid-hidden").text(),b=document.createElement("div"),c=homeUrl+"src/categories.php?postid="+a;console.log(c),b=$(b),$(b).load(c,function(){$("body").append($(b)),$(".dim").show().data("lock","tags"),catPopCallbacks()})}),initEditor()}function addTagToPost(a,b){a.toggleClass("active-tag");var c=a.data("tagid");console.log("adding tag "+a.data("tagid")+" to post "+b),$.post("#",{action:actionAddTagToPost,tagid:c,postid:b},function(a){console.log(a)})}function removeTagFromPost(a,b){a.toggleClass("active-tag");var c=a.data("tagid");console.log("removing tag "+a.data("tagid")+" from post "+b),$.post("#",{action:actionRemoveTagFromPost,tagid:c,postid:b},function(a){console.log(a)})}function addCatToPost(a,b){$(".tag-name").removeClass("active-tag"),a.addClass("active-tag");var c=a.data("catid");console.log("adding tag "+a.data("catid")+" to post "+b),$.post("#",{action:actionAddCatToPost,catid:c,postid:b},function(a){console.log(a)})}function removeCatFromPost(a,b){$(".tag-name").removeClass("active-tag");var c=a.data("catid");console.log("removing tag "+a.data("catid")+" from post "+b),$.post("#",{action:actionRemoveCatFromPost,catid:c,postid:b},function(a){console.log(a)})}function saveTag(){var a=$("#tag-create-input").val(),b=$("#postid-hidden").text();console.log(a),$.post("#",{action:actionSaveTag,name:a,postid:b},function(a){console.log("callback"),a=JSON.parse(a),console.log(a);var b=new CustomEvent("tag_saved",{detail:a});document.dispatchEvent(b),console.log("after dispatching event")})}function saveCat(){console.log("event function fired");var a=$("#tag-create-input").val(),b=$("#postid-hidden").text();console.log(a),$.post("#",{action:actionSaveCat,name:a,postid:b},function(a){console.log("callback"),a=JSON.parse(a),console.log(a);var b=new CustomEvent("cat_saved",{detail:a});document.dispatchEvent(b),console.log("after dispatching event")})}function savePost(){var a=$("#content").html(),b=$("#post-title").val(),c=!1,d=$("#postid-hidden").text();console.log(d),$.post("#",{action:actionSavePost,name:b,file:a,draft:c,postid:d},function(a){console.log(a),a=JSON.parse(a),$("#postid-hidden").text(a.postid);var b=new Event("post_saved");document.dispatchEvent(b)})}function uploadImage(a){console.log("Uploading image");var b={action:actionUploadImage,imgdata:a};console.log(b),$.ajax({url:"#",type:"POST",processData:!1,contentType:!1,data:a}).done(function(a){console.log("done uploading image"),console.log(a);var b=new Event("image_uploaded");document.dispatchEvent(b)})}function createMessage(a){$("#message-message").html(a),$(".dim").show(),$("#message").fadeIn()}function validatePost(){var a=$("#post-title").val();return""!=a||(createMessage("Your post needs a title."),!1)}function load(a){switch(a){case"start":$(".dim").show(),$(".loading").show();break;case"stop":$(".dim").hide(),$(".loading").hide()}}function initEditor(){$("#italic").on("click",function(){document.execCommand("italic")}),$("#bold").on("click",function(){document.execCommand("bold")}),$("#underline").on("click",function(){document.execCommand("underline")}),$("#strike").on("click",function(){document.execCommand("strikeThrough")}),$("#left").on("click",function(){document.execCommand("justifyLeft")}),$("#center").on("click",function(){document.execCommand("justifyCenter")}),$("#right").on("click",function(){document.execCommand("justifyRight")}),$("#justify").on("click",function(){document.execCommand("justifyFull")}),$("#undo").on("click",function(){document.execCommand("undo")}),$("#redo").on("click",function(){document.execCommand("redo")}),$("#header").on("click",function(){document.execCommand("formatBlock",!1,"H2")}),$("#show-colors-modal").on("click",function(){$("#colors-modal").css("display","inline-block")}),$(".color-choose").on("click",function(){console.log("stuff is happen");var a=document.getSelection();console.log("selection"+a);var b=$(this).data("r"),c=$(this).data("g"),d=$(this).data("b"),e="rgb("+b+", "+c+", "+d+")";document.execCommand("foreColor",!1,e)}),$("#link").on("click",function(){var a=document.getSelection();if(""!=a){var b="";a.anchorNode.parentNode&&a.anchorNode.parentNode.href&&(b=a.anchorNode.parentNode.href);var c=prompt("Enter the link address",b);null!=c&&(c.includes("http://")||c.includes("https://")||(c="http://"+c),document.execCommand("createLink",!1,c))}}),$("#unlink").on("click",function(){document.execCommand("unlink")}),$("#ol").on("click",function(){document.execCommand("insertOrderedList")}),$("#ul").on("click",function(){document.execCommand("insertUnorderedList")}),$("#image").on("click",function(){document.getElementById("img-dialog").showModal()}),$("#image-form").on("submit",function(a){console.log("image form submitted"),a.preventDefault();var b=new FormData(document.getElementById("image-form"));b.append("action",actionUploadImage),uploadImage(b)})}function insertImage(){document.execCommand("insertImage",!1,"http://placebear.com/300/200")&&$("#content").find("img").each(function(){if(!$(this).hasClass("edit-img")){var a=(new Date).getTime(),b="edit-img"+a;wrapImage($(this),a),attachImageEditor($(this),a),$(this).addClass("edit-img").addClass(b).on("click",function(){}),imgEditorCallbacks()}})}function wrapImage(a,b){a.wrap('<div class="inline img-editor-wrap img-editor-wrap'+b+'"></div>').on("click",function(){$(this).parent().find(".img-editor-bar").show()})}function attachImageEditor(a,b){a.after("<div class='img-editor-bar flex flex-hor container'><div data-imgwrap='.img-editor-wrap"+b+"' data-imgtarget='.edit-img"+b+"' class='img-editor-group flex flex-hor'><button type='button' class='btn img-small'><i class='fa fa-picture-o' aria-hidden='true'></i></button><button type='button' class='btn img-medium'><i class='fa fa-picture-o' aria-hidden='true'></i></button><button type='button' class='btn img-large'><i class='fa fa-picture-o' aria-hidden='true'></i></button><button type='button' class='btn img-full'><i class='fa fa-arrows-h' aria-hidden='true'></i></button></div><div data-imgwrap='.img-editor-wrap"+b+"' data-imgtarget='.edit-img"+b+"' class='img-editor-group flex flex-hor'><button class='btn img-left'>"+iconLeftJustify+"</button><button class='btn img-center'>"+iconCenterJustify+"</button><button class='btn img-right'>"+iconRightJustify+"</button></div><div data-imgwrap='.img-editor-wrap"+b+"' data-imgtarget='.edit-img"+b+"' class='img-editor-group flex flex-hor'><button class='btn img-remove'>"+iconRemove+"</button><button class='btn img-close'>"+iconClose+"</button></div></div>")}function imgEditorCallbacks(){function a(a){return $(a.parent().data("imgwrap"))}function b(a){return a.parent().parent()}$(".img-small").on("click",function(){$($(this).parent().data("imgwrap")).css("width","40%")}),$(".img-medium").on("click",function(){$($(this).parent().data("imgwrap")).css("width","60%")}),$(".img-large").on("click",function(){$($(this).parent().data("imgwrap")).css("width","80%")}),$(".img-full").on("click",function(){$($(this).parent().data("imgwrap")).css("width","100%")}),$(".img-left").on("click",function(){$($(this).parent().data("imgwrap")).css({float:"left",display:"inline-block"})}),$(".img-center").on("click",function(){$($(this).parent().data("imgwrap")).css({float:"none",margin:"auto",display:"block"})}),$(".img-right").on("click",function(){a($(this)).css({float:"right",display:"inline-block"})}),$(".img-remove").on("click",function(){confirm("Are you sure you want to remove this image?")&&a($(this)).remove()}),$(".img-close").on("click",function(){b($(this)).fadeOut()})}function modifyWith(a){addUndoState();var b=document.createRange(),c=document.getElementById("frame").contentWindow.getSelection();b=c.getRangeAt(0);var d=(b.cloneContents(),b.startContainer),e=!1;null!=d&&(hasParentOf(d,a)?(removeProperty(b,a,c),e=!0):hasInitialChildOf(d,a)?(removeProperty(b,a,c),e=!0):(addProperty(b,a,c),e=!1)),adjustEditButtons(!e,a),cleanUp(document.getElementById("frame").contentWindow.document.getElementById("content")),focus()}function getTextNodes(a){for(var b,c=[],d=[],e=0;e<a.childNodes.length;e++)if(b=a.childNodes[e],"#text"===b.nodeName)c.push(b);else if(b.hasChildNodes()){d=getTextNodes(b);for(var f=0;f<d.length;f++)c.push(d[f])}return c}function addProperty(a,b,c){if(document.getElementById("frame").contentWindow.document.getElementById("content").normalize(),"#text"===a.endContainer.nodeName&&a.endContainer.splitText(a.endOffset),"#text"===a.startContainer.nodeName){var d=a.startContainer.splitText(a.startOffset);a.setStartAfter(d)}for(var e,f,g,h=getTextNodes(document.getElementById("frame").contentWindow.document.getElementById("content")),i=document.createRange(),j=0;j<h.length;j++)if(e=h[j],a.intersectsNode(e)){if(hasParentOf(e,b))continue;i.selectNode(e);var k=document.createElement(b);i.surroundContents(k),null==g&&(g=k),f=e}a.selectNodeContents(g),a.setEndAfter(f),c.removeAllRanges(),c.addRange(a)}function removeProperty(a,b,c){if(document.getElementById("frame").contentWindow.document.getElementById("content").normalize(),"#text"===a.endContainer.nodeName&&a.endContainer.splitText(a.endOffset),"#text"===a.startContainer.nodeName){var d=a.startContainer.splitText(a.startOffset);a.setStartAfter(d)}for(var e,f,g,h=getTextNodes(document.getElementById("frame").contentWindow.document.getElementById("content")),i=document.createRange(),j=0;j<h.length;j++)if(e=h[j],a.intersectsNode(e)&&hasParentOf(e,b)){var k=b.toLowerCase(),l=document.createElement("SPAN");i.selectNode(e),i.surroundContents(l)}for(var m=document.getElementById("frame").contentWindow.document.getElementById("content").innerHTML.toString(),n=m,o=m.match(/<span>/g),p=o.length,q="<em id='range-start'>",r="<em id='range-end'>",s="</em>",t=0;t<p;t++)0==t?t==p-1?(n=n.replace("<span>","</"+k+">"+r+q),n=n.replace("</span>",s+""+s+"<"+k+">")):(n=n.replace("<span>","</"+k+">"+q),n=n.replace("</span>",s+"<"+k+">")):t==p-1?(n=n.replace("<span>","</"+k+">"+r),n=n.replace("</span>",s+"<"+k+">")):(n=n.replace("<span>","</"+k+">"),n=n.replace("</span>","<"+k+">"));var m=document.getElementById("frame").contentWindow.document.getElementById("content").innerHTML=n;g=document.getElementById("frame").contentWindow.document.getElementById("range-start"),f=document.getElementById("frame").contentWindow.document.getElementById("range-end");var u=document.createTextNode(g.textContent);g.parentNode.replaceChild(u,g);var v=document.createTextNode(f.textContent);f.parentNode.replaceChild(v,f),a.selectNodeContents(u),a.setEndAfter(v),c.removeAllRanges(),c.addRange(a)}function changeTextAlign(a){addUndoState();for(var b=document.getElementById("frame").contentWindow.getSelection(),c=b.getRangeAt(0),d=document.getElementById("frame").contentWindow.document.getElementById("content").getElementsByTagName("DIV"),e=document.getElementById("frame").contentWindow.document.getElementById("content").getElementsByTagName("H3"),f=d.length-1;f>=0;f--)""!=d[f].textContent&&c.intersectsNode(d[f])&&(d[f].style.textAlign=a);for(var f=e.length-1;f>=0;f--)""!=e[f].textContent&&c.intersectsNode(e[f])&&(e[f].style.textAlign=a)}function myUndo(){if(!(undoStates.length<=0)){var a=document.getElementById("frame"),b=(a.contentWindow,document.getElementById("content"));redoStates.push(currentState),b.innerHTML=undoStates.pop(),currentState=b.innerHTML,adjustUndoButtons()}}function myRedo(){if(!(redoStates.length<=0)){var a=document.getElementById("frame"),b=(a.contentWindow,document.getElementById("content"));b.innerHTML=redoStates[redoStates.length-1],undoStates.push(redoStates.pop()),adjustUndoButtons()}}function changeWriter(a){addUndoState();var b,c,d=document.getElementById("frame").contentWindow.getSelection(),e=d.getRangeAt(0);switch(e.startContainer,a){case"header":b="H3",c="DIV";break;case"normal":b="DIV",c="H3"}for(var f,g=document.getElementById("frame").contentWindow.document.getElementById("content").getElementsByTagName(c),h=g.length-1;h>=0;h--)""!=g[h].textContent&&e.intersectsNode(g[h])&&(f=document.createElement(b),f.innerHTML=g[h].innerHTML,f.textContent=g[h].textContent,g[h].parentNode.replaceChild(f,g[h]))}function cleanUp(a){if(a.hasChildNodes()||"BR"==a.nodeName||"#text"==a.nodeName)if(""!=a.textContent&&" "!=a.textContent||"BR"==a.nodeName||"DIV"==a.nodeName||"IMG"==a.nodeName)for(var b=0;b<a.childNodes.length;b++)cleanUp(a.childNodes[b]);else a.parentNode.removeChild(a);else a.parentNode.removeChild(a)}function adjustEditButtons(a,b){b===italic?a?document.getElementById("italic").style.backgroundColor="#dcdcdc":document.getElementById("italic").style.backgroundColor="white":b===bold?a?document.getElementById("bold").style.backgroundColor="#dcdcdc":document.getElementById("bold").style.backgroundColor="white":b===underline?a?document.getElementById("underline").style.backgroundColor="#dcdcdc":document.getElementById("underline").style.backgroundColor="white":b===strike&&(a?document.getElementById("strike").style.backgroundColor="#dcdcdc":document.getElementById("strike").style.backgroundColor="white")}function isNodeNameSpecial(a){return a.nodeName===bold||a.nodeName===italic||a.nodeName===underline||a.nodeName===strike||"SPAN"===a.nodeName||"A"===a.nodeName||"LI"===a.nodeName}function hasParentOf(a,b){if(a.parentNode){if(a.parentNode.nodeName===b)return!0;if(isNodeNameSpecial(a.parentNode))return hasParentOf(a.parentNode,b);if(a.nodeName===b)return!0}else if(a.nodeName===b)return!0;return!1}function hasInitialChildOf(a,b){if(a.nodeName==b)return a;if(a.hasChildNodes()){var c=a.firstChild,d=hasInitialChildOf(c,b);if(null!=d)return d}return null}function initCurrentState(){var a=document.getElementById("frame"),b=(a.contentWindow,document.getElementById("content"));currentState=b.innerHTML}function addUndoState(){var a=document.getElementById("frame"),b=(a.contentWindow,document.getElementById("content"));undoStates.push(currentState),currentState=b.innerHTML,undoStates.length>20&&undoStates.shift(),redoStates=[],adjustUndoButtons()}function adjustUndoButtons(){var a=document.getElementById("undo"),b=document.getElementById("redo");undoStates.length<=0?(a.style.color=cannotColor,a.style.boxShadow=shadow+cannotColor):(a.style.color="black",a.style.boxShadow=shadow+canColor),redoStates.length<=0?(b.style.color=cannotColor,b.style.boxShadow=shadow+cannotColor):(b.style.color="black",b.style.boxShadow=shadow+canColor)}function focus(){document.getElementById("frame").contentWindow.document.getElementById("content").focus()}function showDialog(){var a=document.getElementById("frame").contentWindow.getSelection(),b=a.getRangeAt(0);b.startContainer,imgPosition=b,document.getElementById("upload-preview").src="",document.getElementById("img-dialog").showModal()}function cancelDialog(){document.getElementById("img-dialog").close()}function closeDialog(){addUndoState();var a=document.getElementById("upload-preview").src,b=document.createElement("DIV");b.className="separator",b.style.clear="both",b.style.textAlign="center",b.style.zIndex="1",b.style.width="360px",b.style.height="270px",b.style.cursor="pointer",b.style.margin="auto";var c=document.createElement("img");return c.src=a,b.appendChild(c),c.style.maxWidth="100%",c.style.maxHeight="100%",c.style.position="absolute",c.style.top="50%",c.style.left="50%",c.style.objectFit="contain",c.style.transform="translate(-50%, -50%)",imgPosition.insertNode(b),b.setAttribute("onclick","showImageOptions(this);"),document.getElementById("img-dialog").close(),!1}function uploadPreview(a){var b=new FormData(document.getElementById("image-form"));$.ajax({url:"uploadimage.php",type:"POST",data:b,datatype:"json",enctype:"multipart/form-data",processData:!1,contentType:!1}).done(function(a){var b=a;alert("imgPath: "+b),document.getElementById("upload-preview").src=b})}function printChanges(){var a=document.getElementById("frame").contentWindow.document.getElementById("content").innerHTML;document.getElementById("underhood").textContent=a,document.getElementById("frame").contentWindow.document.getElementById("content").focus()}function exitAndSave(){if(confirm("Do you really want to exit?")){var a=document.getElementById("frame").contentWindow.document.getElementById("content").innerHTML,b=document.getElementById("title").value,c="draft",d=document.getElementById("postid-hidden").textContent;$.post("rduploadpost.php",{name:b,file:a,draft:c,postid:d},function(a){alert(a)}),window.location.href="http://www.thenoticed.com/rdportal.php"}}function exitNoSave(){confirm("Do you really want to exit? Your changes will not be saved.")&&(window.location.href="http://www.thenoticed.com/rdportal.php")}function save(a){var b=document.getElementById("frame").contentWindow.document.getElementById("content").innerHTML,c=document.getElementById("title").value,d="draft",e=document.getElementById("postid-hidden").textContent;$.post("rduploadpost.php",{name:c,file:b,draft:d,postid:e},function(a){alert(a)})}function saveFirstTime(){var a=document.getElementById("frame").contentWindow.document.getElementById("content").innerHTML,b=document.getElementById("title").value,c="draft",d="";$.post("rduploadpost.php",{name:b,file:a,draft:c,postid:d},function(a){window.location.href="http://www.thenoticed.com/rdeditpost.php?postid="+a})}function updatePost(a){var b=document.getElementById("frame").contentWindow.document.getElementById("content").innerHTML,c=document.getElementById("title").value,d="published";document.getElementById("postid-hidden").textContent,$.post("rdupdatepost.php",{name:c,file:b,draft:d,postid:a},function(a){alert(a)}),window.location.href="http://www.thenoticed.com/rdportal.php"}function makeDraft(a){var b=document.getElementById("frame").contentWindow.document.getElementById("content").innerHTML,c=document.getElementById("title").value,d="draft";$.post("rdupdatepost.php",{name:c,file:b,draft:d,postid:a},function(a){alert(a)}),window.location.href="http://www.thenoticed.com/rdportal.php"}function publishDraft(a){var b=document.getElementById("frame").contentWindow.document.getElementById("content").innerHTML,c=document.getElementById("title").value,d="published";confirm("Are you sure?")&&$.post("rdupdatepost.php",{name:c,file:b,draft:d,postid:a},function(a){alert(a),window.location.href="http://www.thenoticed.com/rdportal.php"})}function preview(a){}function showImageOptions(a){if(null!=document.getElementById("img-options-id")){var b=document.getElementById("img-options-id");b.parentNode.removeAttribute("id"),b.parentNode.removeChild(b)}a.id="img-separator";var c="DIV",d="BUTTON",e=(a.firstChild,create(c)),f=create(c),g=create(d),h=create(d),i=create(d),j=create(d),k=create(c),l=create(d),m=create(d),n=create(d),o=create(c),p=create(d),q=create(d);g.appendChild(text("S")),h.appendChild(text("M")),i.appendChild(text("L")),j.appendChild(text("XL")),l.appendChild(text("Left")),m.appendChild(text("Middle")),n.appendChild(text("Right")),p.appendChild(text("Caption")),q.appendChild(text("Remove")),f.appendChild(g),f.appendChild(h),f.appendChild(i),f.appendChild(j),k.appendChild(l),k.appendChild(m),k.appendChild(n),o.appendChild(p),o.appendChild(q),e.appendChild(f),e.appendChild(k),e.appendChild(o),g.setAttribute("onclick","imgResize('small', document.getElementById('img-separator'));"),h.setAttribute("onclick","imgResize('med', document.getElementById('img-separator'));"),i.setAttribute("onclick","imgResize('large', document.getElementById('img-separator'));"),j.setAttribute("onclick","imgResize('xlarge', document.getElementById('img-separator'));"),l.setAttribute("onclick","imgPosition('left', document.getElementById('img-separator'));"),m.setAttribute("onclick","imgPosition('mid', document.getElementById('img-separator'));"),n.setAttribute("onclick","imgPosition('right', document.getElementById('img-separator'));"),p.setAttribute("onclick","imgCaption(document.getElementById('img-separator'));"),q.setAttribute("onclick","imgRemove(document.getElementById('img-separator'));"),e.id="img-options-id",e.className="img-options",e.style.position="fixed",e.style.display="block",e.style.top="75%",e.style.left="50%",e.style.transform="translate(-50%, -50%)",e.style.WebkitTransform="translate (-50%, -50%)",e.style.backgroundColor="rgb(15, 192, 252)";var r=create(d);r.style.border="none",r.style.backgroundColor="rgb(15, 192, 252)",r.style.width="16px",r.style.color="white",r.setAttribute("onclick","closeImageOptions(document.getElementsByClassName('img-options')[0])"),r.appendChild(text("X")),e.appendChild(r),a.parentNode.appendChild(e)}function closeImageOptions(a){var b=document.getElementById("img-separator");b.removeAttribute("id"),a.parentNode.removeChild(a)}function create(a){return document.createElement(a)}function text(a){return document.createTextNode(a)}function imgResize(a,b){var c=document.createElement("img");c.src=b.firstChild.src;var d=c.width,e=c.height,f=d/e,g="320px",h="240px";switch(a){case"small":g="240px",imgH=Math.floor(240/f),h=imgH+"px";break;case"med":g="360px",imgH=Math.floor(360/f),h=imgH+"px";break;case"large":g="480px",imgH=Math.floor(480/f),h=imgH+"px";break;case"xlarge":g="592px",imgH=Math.floor(592/f),h=imgH+"px";break;case"large-":g="592px",imgH=Math.floor(240*f),h=imgH+"px"}b.style.width=g,b.style.height=h}function imgPosition(a,b){var c="auto",d="auto";switch(a){case"left":c="2px";break;case"right":d="2px"}b.style.marginLeft=c,b.style.marginRight=d}function imgCaption(a){alert("This function is not available yet.")}function imgRemove(a){confirm("Remove this image?")&&(closeImageOptions(document.getElementsByClassName("img-options")[0]),a.parentNode.removeChild(a))}function modifyWith(a){addUndoState();var b=document.createRange(),c=document.getElementById("frame").contentWindow.getSelection();b=c.getRangeAt(0);var d=(b.cloneContents(),b.startContainer),e=!1;null!=d&&(hasParentOf(d,a)?(removeProperty(b,a,c),e=!0):hasInitialChildOf(d,a)?(removeProperty(b,a,c),e=!0):(addProperty(b,a,c),e=!1)),adjustEditButtons(!e,a),cleanUp(document.getElementById("frame").contentWindow.document.getElementById("content")),focus()}function getTextNodes(a){for(var b,c=[],d=[],e=0;e<a.childNodes.length;e++)if(b=a.childNodes[e],"#text"===b.nodeName)c.push(b);else if(b.hasChildNodes()){d=getTextNodes(b);for(var f=0;f<d.length;f++)c.push(d[f])}return c}function addProperty(a,b,c){if(document.getElementById("frame").contentWindow.document.getElementById("content").normalize(),"#text"===a.endContainer.nodeName){a.endContainer.splitText(a.endOffset)}if("#text"===a.startContainer.nodeName){var d=a.startContainer.splitText(a.startOffset);a.setStartAfter(d)}for(var e,f,g,h=getTextNodes(document.getElementById("frame").contentWindow.document.getElementById("content")),i=document.createRange(),j=0;j<h.length;j++)if(e=h[j],a.intersectsNode(e)){if(hasParentOf(e,b))continue;i.selectNode(e);var k=document.createElement(b);i.surroundContents(k),null==g&&(g=k),f=e}a.selectNodeContents(g),a.setEndAfter(f),c.removeAllRanges(),c.addRange(a)}function removeProperty(a,b,c){if(document.getElementById("frame").contentWindow.document.getElementById("content").normalize(),"#text"===a.endContainer.nodeName){a.endContainer.splitText(a.endOffset)}if("#text"===a.startContainer.nodeName){var d=a.startContainer.splitText(a.startOffset);a.setStartAfter(d)}for(var e,f,g,h=getTextNodes(document.getElementById("frame").contentWindow.document.getElementById("content")),i=document.createRange(),j=0;j<h.length;j++)if(e=h[j],a.intersectsNode(e)&&hasParentOf(e,b)){var k=b.toLowerCase(),l=document.createElement("SPAN");i.selectNode(e),i.surroundContents(l)}for(var m=document.getElementById("frame").contentWindow.document.getElementById("content").innerHTML.toString(),n=m,o=m.match(/<span>/g),p=o.length,q="<em id='range-start'>",r="<em id='range-end'>",s="</em>",t=0;t<p;t++)0==t?t==p-1?(n=n.replace("<span>","</"+k+">"+r+q),n=n.replace("</span>",s+""+s+"<"+k+">")):(n=n.replace("<span>","</"+k+">"+q),n=n.replace("</span>",s+"<"+k+">")):t==p-1?(n=n.replace("<span>","</"+k+">"+r),n=n.replace("</span>",s+"<"+k+">")):(n=n.replace("<span>","</"+k+">"),n=n.replace("</span>","<"+k+">"));var m=document.getElementById("frame").contentWindow.document.getElementById("content").innerHTML=n;g=document.getElementById("frame").contentWindow.document.getElementById("range-start"),f=document.getElementById("frame").contentWindow.document.getElementById("range-end");var u=document.createTextNode(g.textContent);g.parentNode.replaceChild(u,g);var v=document.createTextNode(f.textContent);f.parentNode.replaceChild(v,f),a.selectNodeContents(u),a.setEndAfter(v),c.removeAllRanges(),c.addRange(a)}function changeTextAlign(a){addUndoState();for(var b=document.getElementById("frame").contentWindow.getSelection(),c=b.getRangeAt(0),d=document.getElementById("frame").contentWindow.document.getElementById("content").getElementsByTagName("DIV"),e=document.getElementById("frame").contentWindow.document.getElementById("content").getElementsByTagName("H3"),f=d.length-1;f>=0;f--)""!=d[f].textContent&&c.intersectsNode(d[f])&&(d[f].style.textAlign=a);for(var f=e.length-1;f>=0;f--)""!=e[f].textContent&&c.intersectsNode(e[f])&&(e[f].style.textAlign=a)}function myUndo(){if(!(undoStates.length<=0)){var a=document.getElementById("frame"),b=(a.contentWindow,document.getElementById("content"));redoStates.push(currentState),b.innerHTML=undoStates.pop(),currentState=b.innerHTML,adjustUndoButtons()}}function myRedo(){if(!(redoStates.length<=0)){var a=document.getElementById("frame"),b=(a.contentWindow,document.getElementById("content"));b.innerHTML=redoStates[redoStates.length-1],undoStates.push(redoStates.pop()),adjustUndoButtons()}}function changeWriter(a){addUndoState();var b,c,d=document.getElementById("frame").contentWindow.getSelection(),e=d.getRangeAt(0);e.startContainer;switch(a){case"header":b="H3",c="DIV";break;case"normal":b="DIV",c="H3"}for(var f,g=document.getElementById("frame").contentWindow.document.getElementById("content").getElementsByTagName(c),h=g.length-1;h>=0;h--)""!=g[h].textContent&&e.intersectsNode(g[h])&&(f=document.createElement(b),f.innerHTML=g[h].innerHTML,f.textContent=g[h].textContent,g[h].parentNode.replaceChild(f,g[h]))}function cleanUp(a){if(a.hasChildNodes()||"BR"==a.nodeName||"#text"==a.nodeName)if(""!=a.textContent&&" "!=a.textContent||"BR"==a.nodeName||"DIV"==a.nodeName||"IMG"==a.nodeName)for(var b=0;b<a.childNodes.length;b++)cleanUp(a.childNodes[b]);else a.parentNode.removeChild(a);else a.parentNode.removeChild(a)}function adjustEditButtons(a,b){b===italic?a?document.getElementById("italic").style.backgroundColor="#dcdcdc":document.getElementById("italic").style.backgroundColor="white":b===bold?a?document.getElementById("bold").style.backgroundColor="#dcdcdc":document.getElementById("bold").style.backgroundColor="white":b===underline?a?document.getElementById("underline").style.backgroundColor="#dcdcdc":document.getElementById("underline").style.backgroundColor="white":b===strike&&(a?document.getElementById("strike").style.backgroundColor="#dcdcdc":document.getElementById("strike").style.backgroundColor="white")}function isNodeNameSpecial(a){return a.nodeName===bold||a.nodeName===italic||a.nodeName===underline||a.nodeName===strike||"SPAN"===a.nodeName||"A"===a.nodeName||"LI"===a.nodeName}function hasParentOf(a,b){if(a.parentNode){if(a.parentNode.nodeName===b)return!0;if(isNodeNameSpecial(a.parentNode))return hasParentOf(a.parentNode,b);if(a.nodeName===b)return!0}else if(a.nodeName===b)return!0;return!1}function hasInitialChildOf(a,b){if(a.nodeName==b)return a;if(a.hasChildNodes()){var c=a.firstChild,d=hasInitialChildOf(c,b);if(null!=d)return d}return null}function initCurrentState(){var a=document.getElementById("frame"),b=(a.contentWindow,document.getElementById("content"));currentState=b.innerHTML}function addUndoState(){var a=document.getElementById("frame"),b=(a.contentWindow,document.getElementById("content"));undoStates.push(currentState),currentState=b.innerHTML,undoStates.length>20&&undoStates.shift(),redoStates=[],adjustUndoButtons()}function adjustUndoButtons(){var a=document.getElementById("undo"),b=document.getElementById("redo");undoStates.length<=0?(a.style.color=cannotColor,a.style.boxShadow=shadow+cannotColor):(a.style.color="black",a.style.boxShadow=shadow+canColor),redoStates.length<=0?(b.style.color=cannotColor,b.style.boxShadow=shadow+cannotColor):(b.style.color="black",b.style.boxShadow=shadow+canColor)}function focus(){document.getElementById("frame").contentWindow.document.getElementById("content").focus()}function showDialog(){var a=document.getElementById("frame").contentWindow.getSelection(),b=a.getRangeAt(0);b.startContainer;imgPosition=b,document.getElementById("upload-preview").src="",document.getElementById("img-dialog").showModal()}function cancelDialog(){document.getElementById("img-dialog").close()}function closeDialog(){addUndoState();var a=document.getElementById("upload-preview").src,b=document.createElement("DIV");b.className="separator",b.style.clear="both",b.style.textAlign="center",b.style.zIndex="1",b.style.width="360px",b.style.height="270px",b.style.cursor="pointer",b.style.margin="auto";var c=document.createElement("img");return c.src=a,b.appendChild(c),c.style.maxWidth="100%",c.style.maxHeight="100%",c.style.position="absolute",c.style.top="50%",c.style.left="50%",c.style.objectFit="contain",c.style.transform="translate(-50%, -50%)",imgPosition.insertNode(b),b.setAttribute("onclick","showImageOptions(this);"),document.getElementById("img-dialog").close(),!1}function uploadPreview(a){var b=new FormData(document.getElementById("image-form"));$.ajax({url:"uploadimage.php",type:"POST",data:b,datatype:"json",enctype:"multipart/form-data",processData:!1,contentType:!1}).done(function(a){var b=a;alert("imgPath: "+b),document.getElementById("upload-preview").src=b})}function printChanges(){var a=document.getElementById("frame").contentWindow.document.getElementById("content").innerHTML;document.getElementById("underhood").textContent=a,document.getElementById("frame").contentWindow.document.getElementById("content").focus()}function exitAndSave(){if(confirm("Do you really want to exit?")){var a=document.getElementById("frame").contentWindow.document.getElementById("content").innerHTML,b=document.getElementById("title").value,c="draft",d=document.getElementById("postid-hidden").textContent;$.post("rduploadpost.php",{name:b,file:a,draft:c,postid:d},function(a){
alert(a)}),window.location.href="http://www.thenoticed.com/rdportal.php"}}function exitNoSave(){confirm("Do you really want to exit? Your changes will not be saved.")&&(window.location.href="http://www.thenoticed.com/rdportal.php")}function save(a){var b=document.getElementById("frame").contentWindow.document.getElementById("content").innerHTML,c=document.getElementById("title").value,d="draft",e=document.getElementById("postid-hidden").textContent;$.post("rduploadpost.php",{name:c,file:b,draft:d,postid:e},function(a){alert(a)})}function saveFirstTime(){var a=document.getElementById("frame").contentWindow.document.getElementById("content").innerHTML,b=document.getElementById("title").value,c="draft",d="";$.post("rduploadpost.php",{name:b,file:a,draft:c,postid:d},function(a){window.location.href="http://www.thenoticed.com/rdeditpost.php?postid="+a})}function updatePost(a){var b=document.getElementById("frame").contentWindow.document.getElementById("content").innerHTML,c=document.getElementById("title").value,d="published";document.getElementById("postid-hidden").textContent;$.post("rdupdatepost.php",{name:c,file:b,draft:d,postid:a},function(a){alert(a)}),window.location.href="http://www.thenoticed.com/rdportal.php"}function makeDraft(a){var b=document.getElementById("frame").contentWindow.document.getElementById("content").innerHTML,c=document.getElementById("title").value,d="draft";$.post("rdupdatepost.php",{name:c,file:b,draft:d,postid:a},function(a){alert(a)}),window.location.href="http://www.thenoticed.com/rdportal.php"}function publishDraft(a){var b=document.getElementById("frame").contentWindow.document.getElementById("content").innerHTML,c=document.getElementById("title").value,d="published";confirm("Are you sure?")&&$.post("rdupdatepost.php",{name:c,file:b,draft:d,postid:a},function(a){alert(a),window.location.href="http://www.thenoticed.com/rdportal.php"})}function preview(a){}function showImageOptions(a){if(null!=document.getElementById("img-options-id")){var b=document.getElementById("img-options-id");b.parentNode.removeAttribute("id"),b.parentNode.removeChild(b)}a.id="img-separator";var c="DIV",d="BUTTON",e=(a.firstChild,create(c)),f=create(c),g=create(d),h=create(d),i=create(d),j=create(d),k=create(c),l=create(d),m=create(d),n=create(d),o=create(c),p=create(d),q=create(d);g.appendChild(text("S")),h.appendChild(text("M")),i.appendChild(text("L")),j.appendChild(text("XL")),l.appendChild(text("Left")),m.appendChild(text("Middle")),n.appendChild(text("Right")),p.appendChild(text("Caption")),q.appendChild(text("Remove")),f.appendChild(g),f.appendChild(h),f.appendChild(i),f.appendChild(j),k.appendChild(l),k.appendChild(m),k.appendChild(n),o.appendChild(p),o.appendChild(q),e.appendChild(f),e.appendChild(k),e.appendChild(o),g.setAttribute("onclick","imgResize('small', document.getElementById('img-separator'));"),h.setAttribute("onclick","imgResize('med', document.getElementById('img-separator'));"),i.setAttribute("onclick","imgResize('large', document.getElementById('img-separator'));"),j.setAttribute("onclick","imgResize('xlarge', document.getElementById('img-separator'));"),l.setAttribute("onclick","imgPosition('left', document.getElementById('img-separator'));"),m.setAttribute("onclick","imgPosition('mid', document.getElementById('img-separator'));"),n.setAttribute("onclick","imgPosition('right', document.getElementById('img-separator'));"),p.setAttribute("onclick","imgCaption(document.getElementById('img-separator'));"),q.setAttribute("onclick","imgRemove(document.getElementById('img-separator'));"),e.id="img-options-id",e.className="img-options",e.style.position="fixed",e.style.display="block",e.style.top="75%",e.style.left="50%",e.style.transform="translate(-50%, -50%)",e.style.WebkitTransform="translate (-50%, -50%)",e.style.backgroundColor="rgb(15, 192, 252)";var r=create(d);r.style.border="none",r.style.backgroundColor="rgb(15, 192, 252)",r.style.width="16px",r.style.color="white",r.setAttribute("onclick","closeImageOptions(document.getElementsByClassName('img-options')[0])"),r.appendChild(text("X")),e.appendChild(r),a.parentNode.appendChild(e)}function closeImageOptions(a){var b=document.getElementById("img-separator");b.removeAttribute("id"),a.parentNode.removeChild(a)}function create(a){return document.createElement(a)}function text(a){return document.createTextNode(a)}function imgResize(a,b){var c=document.createElement("img");c.src=b.firstChild.src;var d=c.width,e=c.height,f=d/e,g="320px",h="240px";switch(a){case"small":g="240px",imgH=Math.floor(240/f),h=imgH+"px";break;case"med":g="360px",imgH=Math.floor(360/f),h=imgH+"px";break;case"large":g="480px",imgH=Math.floor(480/f),h=imgH+"px";break;case"xlarge":g="592px",imgH=Math.floor(592/f),h=imgH+"px";break;case"large-":g="592px",imgH=Math.floor(240*f),h=imgH+"px"}b.style.width=g,b.style.height=h}function imgPosition(a,b){var c="auto",d="auto";switch(a){case"left":c="2px";break;case"right":d="2px"}b.style.marginLeft=c,b.style.marginRight=d}function imgCaption(a){alert("This function is not available yet.")}function imgRemove(a){confirm("Remove this image?")&&(closeImageOptions(document.getElementsByClassName("img-options")[0]),a.parentNode.removeChild(a))}var WELCOME=1,EDITOR=2,postid,iconLeftJustify='<i class="fa fa-align-left" aria-hidden="true"></i>',iconCenterJustify='<i class="fa fa-align-center" aria-hidden="true"></i>',iconRightJustify='<i class="fa fa-align-right" aria-hidden="true"></i>',iconRemove='<i class="fa fa-trash" aria-hidden="true"></i>',iconClose='<i class="fa fa-window-close-o" aria-hidden="true"></i>';$(document).ready(function(){$("#main-container").html("").load("src/welcome.php",function(){mainContainerCallbacks()}),$(".new-post").on("click",function(){load("start"),$("#main-container").html("").load(homeUrl+"src/editor.php",function(){load("stop"),editContainerCallbacks()})}),$(".post-edit").on("click",function(){var a=$(this).data("postid");load("start"),$("#main-container").html("").load(homeUrl+"src/editor.php?postid="+a,function(){editContainerCallbacks(),load("stop")})})});var data;document.addEventListener("image_uploaded",function(a){console.log("modify img elements here")}),document.addEventListener("post_saved",function(a){createMessage("Your post is safe!")},!1),document.addEventListener("tag_saved",function(a){console.log(a.detail);var b=a.detail;createMessage('New tag "'+b.tag_name+'" created!');var c=document.createElement("div"),d=document.createElement("div");c=$(c),d=$(d),c.addClass("tag-name").addClass("active-tag").data("tagid",b.tag_id).text(b.tag_name).appendTo("#active-tags"),d.addClass("tag-id").text(b.tag_id).appendTo(c)},!1),document.addEventListener("cat_saved",function(a){console.log(a.detail);var b=a.detail;createMessage('New category "'+b.cat_name+'" created!');var c=document.createElement("div"),d=document.createElement("div");c=$(c),d=$(d),c.addClass("tag-name").addClass("active-tag").data("catid",b.cat_id).text(b.cat_name).appendTo("#active-tags"),d.addClass("tag-id").text(b.cat_id).appendTo(c)},!1);var WELCOME=1,EDITOR=2;$(document).ready(function(){$("#main-container").html("").load(dashboardTemplateDir+"welcome.html"),$(".new-post").on("click",function(){$("#main-container").html("").load(dashboardTemplateDir+"editor.html")})});var undoStates=[],currentState,redoStates=[],shadow="0px 1px 2px",canColor="#222",cannotColor="#999999",imgPosition,undoStates=[],currentState,redoStates=[],shadow="0px 1px 2px",canColor="#222",cannotColor="#999999",imgPosition;